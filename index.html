<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8">
  <title>Calculadora de Custo por Metro</title>
  <style>
    body { font-family: sans-serif; max-width: 600px; margin: 40px auto; }
    label { display: block; margin-top: 12px; }
    input { width: 100%; padding: 6px; margin-top: 4px; }
    button { margin-top: 20px; padding: 10px; }
    #resultado { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Calculadora de Preço por Metro</h1>

  <label>Preço por Yarda (USD):
    <input type="number" step="0.01" id="preco" value="6.15">
  </label>

  <label>Quantidade (em Yardas):
    <input type="number" step="0.1" id="yardas" value="75">
  </label>

  <label>Peso total (em kg):
    <input type="number" step="0.01" id="peso" value="13.61">
  </label>

  <label>Data (AAAA-MM-DD):
    <input type="date" id="data" value="2025-07-15">
  </label>

  <button onclick="calcular()">Calcular</button>

  <div id="resultado">Aguardando cálculo…</div>

  <script>
    async function calcular() {
      const precoUSD = parseFloat(document.getElementById('preco').value)
      const yardas = parseFloat(document.getElementById('yardas').value)
      const pesoKg = parseFloat(document.getElementById('peso').value)
      const data = document.getElementById('data').value

      const largura = 1.10 // metros
      const taxaFretePorLb = 4.38
      const taxaServico = 0.085

      // Conversões
      const metrosTotais = yardas * 0.9144
      const libras = pesoKg * 2.20462
      const custoFrete = libras * taxaFretePorLb
      const custoMaterialUSD = precoUSD * yardas
      const taxasServicoUSD = custoMaterialUSD * taxaServico
      const totalUSD = custoMaterialUSD + custoFrete + taxasServicoUSD

      let taxaCambio = 0

      try {
        const resposta = await fetch(`https://misty-resonance-7bf4.digitaldois-2df.workers.dev/?date=${data}`)
        const dados = await resposta.json()
        taxaCambio = dados.rate
      } catch {
        document.getElementById('resultado').innerText = 'Erro ao obter taxa de câmbio.'
        return
      }

      const totalEUR = totalUSD * taxaCambio
      const custoPorMetro = totalEUR / metrosTotais

      document.getElementById('resultado').innerText =
        `Custo estimado: €${custoPorMetro.toFixed(2)} por metro (à taxa de ${taxaCambio.toFixed(4)} em ${data})`
    }
  </script>
</body>
</html>
