<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Calculadora de Preço de Tecidos</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; padding: 0 10px; }
    label { display: block; margin-top: 15px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
    button { margin-top: 20px; padding: 10px; width: 100%; font-weight: bold; cursor: pointer; }
    .resultado { margin-top: 25px; font-size: 1.2em; font-weight: bold; }
    .erro { color: red; margin-top: 15px; }
  </style>
</head>
<body>

  <h1>Calculadora de Preço de Tecidos</h1>

  <label for="yards">Quantidade (yards):</label>
  <input type="number" id="yards" min="0" step="0.01" value="15" />

  <label for="priceUsd">Preço por yard (USD):</label>
  <input type="number" id="priceUsd" min="0" step="0.01" value="6.15" />

  <label for="date">Data da taxa de câmbio:</label>
  <input type="date" id="date" value="" max="" />

  <button id="calcular">Calcular</button>

  <div class="erro" id="erro"></div>
  <div class="resultado" id="resultado"></div>

  <script>
    // Ajustar a data max para hoje
    const dateInput = document.getElementById('date');
    const hoje = new Date().toISOString().split('T')[0];
    dateInput.max = hoje;
    dateInput.value = hoje;

    function yardsParaMetros(yards) {
      return yards * 0.9144;
    }

    document.getElementById('calcular').addEventListener('click', () => {
      const yards = parseFloat(document.getElementById('yards').value);
      const priceUsd = parseFloat(document.getElementById('priceUsd').value);
      const date = dateInput.value;

      if (isNaN(yards) || yards <= 0 || isNaN(priceUsd) || priceUsd <= 0) {
        document.getElementById('erro').textContent = 'Por favor, insira valores válidos para quantidade e preço.';
        document.getElementById('resultado').textContent = '';
        return;
      }

      document.getElementById('erro').textContent = '';
      document.getElementById('resultado').textContent = 'A obter taxa de câmbio...';

      fetch(`https://api.exchangerate.host/convert?from=USD&to=EUR&date=${date}`)
        .then(res => {
          if (!res.ok) throw new Error('Erro na API');
          return res.json();
        })
        .then(data => {
          const rate = data.result;
          if (!rate) throw new Error('Taxa de câmbio não encontrada');

          const metros = yardsParaMetros(yards);
          const priceEur = priceUsd * rate;
          const pricePorMetro = priceEur / metros;

          document.getElementById('resultado').textContent = 
            `Preço por metro estimado: €${pricePorMetro.toFixed(2)} (taxa do dia ${date})`;
        })
        .catch(() => {
          document.getElementById('erro').textContent = 'Erro ao obter taxa de câmbio.';
          document.getElementById('resultado').textContent = '';
        });
    });
  </script>

</body>
</html>
